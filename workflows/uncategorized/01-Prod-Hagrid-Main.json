{
  "updatedAt": "2025-06-30T08:12:32.499Z",
  "createdAt": "2025-06-30T08:08:40.559Z",
  "id": "l3VzrmMbOUXq4QDH",
  "name": "01-Prod-Hagrid-Main",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://integral-squirrel-52866.upstash.io/lpush/myfurryprints_queue",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"submission_id\": \"{{ $json.body.submission_id }}\",\n  \"customer_data\": {{ JSON.stringify($json.body.data) }},\n  \"timestamp\": \"{{ new Date().toISOString() }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        360,
        280
      ],
      "id": "783e40a3-fbd0-4719-82d4-0c1888a6d492",
      "name": "AddToQueue",
      "credentials": {
        "httpHeaderAuth": {
          "id": "OU4p8zTKeY9k8OYC",
          "name": "Upstash_new"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "29bc334f-d636-43cc-920f-15b5a5427773",
        "options": {
          "allowedOrigins": "*",
          "binaryPropertyName": "images"
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        20,
        280
      ],
      "id": "bc8adf7a-9706-42a9-898a-daf74b2c290c",
      "name": "Webhook",
      "webhookId": "29bc334f-d636-43cc-920f-15b5a5427773"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://integral-squirrel-52866.upstash.io/get/processing_lock",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        780,
        280
      ],
      "id": "dc700400-73eb-4e85-afa5-86af30f529c5",
      "name": "CheckProcessingLock",
      "credentials": {
        "httpHeaderAuth": {
          "id": "OU4p8zTKeY9k8OYC",
          "name": "Upstash_new"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c61f1c28-46d7-4c55-b2a2-cea646a58c02",
              "leftValue": "={{ $json.result }}",
              "rightValue": "null",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        980,
        280
      ],
      "id": "6fdf82f7-0e0a-4cad-b25f-ef26aeb42220",
      "name": "If Not Processing"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://integral-squirrel-52866.upstash.io/setex/processing_lock/3700/processing",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1220,
        280
      ],
      "id": "4fa76e53-1f84-42e3-ad8b-d204ec3f8ffe",
      "name": "SetProcessingLock",
      "credentials": {
        "httpHeaderAuth": {
          "id": "OU4p8zTKeY9k8OYC",
          "name": "Upstash_new"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "1059HGYFIUzHErGh",
          "mode": "list",
          "cachedResultName": "02-PicassoAlternative - Backup"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        1660,
        280
      ],
      "id": "232e200b-4e6a-451b-91e7-3a71bcdd1f3c",
      "name": "Execute Workflow1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://integral-squirrel-52866.upstash.io/rpop/myfurryprints_queue",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1440,
        280
      ],
      "id": "3412a6d0-129b-441e-be05-bd4569681301",
      "name": "PopJobAndProcess",
      "credentials": {
        "httpHeaderAuth": {
          "id": "OU4p8zTKeY9k8OYC",
          "name": "Upstash_new"
        }
      }
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        500,
        480
      ],
      "id": "9df0ca6a-0e25-45a1-9ece-a7fe06a705ca",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "content": "WORKFLOW 1\n\n\nThis workflow handles incoming data from users and adds them to a queue in redis for processing. It makes sure that only one job is processed at a time by checking a processing lock in Redis (via Upstash). When ready, it pops a job from the queue, locks the processing, and triggers another workflow to handle the actual job. It helps manage jobs smoothly without overloading the system.",
        "height": 200,
        "width": 640
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ],
      "id": "533479e6-f066-454c-b9d5-2a9811bb69e8",
      "name": "Sticky Note"
    }
  ],
  "connections": {
    "AddToQueue": {
      "main": [
        [
          {
            "node": "CheckProcessingLock",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "AddToQueue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CheckProcessingLock": {
      "main": [
        [
          {
            "node": "If Not Processing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Not Processing": {
      "main": [
        [
          {
            "node": "SetProcessingLock",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SetProcessingLock": {
      "main": [
        [
          {
            "node": "PopJobAndProcess",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PopJobAndProcess": {
      "main": [
        [
          {
            "node": "Execute Workflow1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "CheckProcessingLock",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "primary-production-2739c.up.railway.app",
            "user-agent": "Paperform/1.0",
            "content-length": "3593",
            "content-type": "application/json",
            "x-forwarded-for": "18.210.14.97",
            "x-forwarded-host": "primary-production-2739c.up.railway.app",
            "x-forwarded-proto": "https",
            "x-railway-edge": "railway/us-east4-eqdc4a",
            "x-railway-request-id": "agD7t3MxSImPE-hoCx5-qw",
            "x-real-ip": "18.210.14.97",
            "x-request-start": "1751119310051",
            "accept-encoding": "gzip"
          },
          "params": {},
          "query": {},
          "body": {
            "data": [
              {
                "title": "Who is your furry friend ? ",
                "description": "",
                "type": "choices",
                "key": "tjhn",
                "custom_key": null,
                "value": "Dog"
              },
              {
                "title": "What is your pet's sex?",
                "description": null,
                "type": "choices",
                "key": "70foo",
                "custom_key": null,
                "value": "Female"
              },
              {
                "title": "Your pet's name",
                "description": "",
                "type": "text",
                "key": "1pl93",
                "custom_key": null,
                "value": "Luna2"
              },
              {
                "title": "Pet photos",
                "description": "Please upload 4 to 6 pictures of your pet",
                "type": "image",
                "key": "8objr",
                "custom_key": null,
                "value": [
                  {
                    "url": "https://paperform.co/file/s3.amazonaws.com/pf-user-files-01/t-474237/uploads/2025-06-28/zgc32jf/1000057312.jpg?expires=1751724109&signature=5d7e6d71da5b92271f95757ca87a8e3264be730843251aa14aa75756c65c5973",
                    "name": "1000057312.jpg",
                    "type": "image/jpeg",
                    "size": 4219078,
                    "width": 3000,
                    "height": 4000
                  },
                  {
                    "url": "https://paperform.co/file/s3.amazonaws.com/pf-user-files-01/t-474237/uploads/2025-06-28/y0932gu/1000057311.jpg?expires=1751724109&signature=6d8ae47117c813511232358f5e1a8b24694163de815e743a418cb097ef8a168b",
                    "name": "1000057311.jpg",
                    "type": "image/jpeg",
                    "size": 3307975,
                    "width": 3000,
                    "height": 4000
                  },
                  {
                    "url": "https://paperform.co/file/s3.amazonaws.com/pf-user-files-01/t-474237/uploads/2025-06-28/xe8326y/1000057313.jpg?expires=1751724109&signature=7a1284eb59ec90ae1b89a93ed6a48b562a3c16e3ff657a9886749a959c739637",
                    "name": "1000057313.jpg",
                    "type": "image/jpeg",
                    "size": 3417440,
                    "width": 3000,
                    "height": 4000
                  },
                  {
                    "url": "https://paperform.co/file/s3.amazonaws.com/pf-user-files-01/t-474237/uploads/2025-06-28/ws732gx/1000057310.jpg?expires=1751724109&signature=d6f58bd8add682e24415bb3a7aa55f88f7e77701a9b6e3e09dfb5ea3cf229632",
                    "name": "1000057310.jpg",
                    "type": "image/jpeg",
                    "size": 3728402,
                    "width": 3000,
                    "height": 4000
                  },
                  {
                    "url": "https://paperform.co/file/s3.amazonaws.com/pf-user-files-01/t-474237/uploads/2025-06-28/z1b322c/1000057309.jpg?expires=1751724109&signature=702e47ccdfb9d3294f92368fe5771e4d63211bb6f5ab4ee197e577837ccc33f6",
                    "name": "1000057309.jpg",
                    "type": "image/jpeg",
                    "size": 3755323,
                    "width": 3000,
                    "height": 4000
                  },
                  {
                    "url": "https://paperform.co/file/s3.amazonaws.com/pf-user-files-01/t-474237/uploads/2025-06-28/yma326m/1000057314.jpg?expires=1751724109&signature=04ecd2fcb2a4d8aab47f09adfa738912f4efb53f6b4335ac917a844da3c7482c",
                    "name": "1000057314.jpg",
                    "type": "image/jpeg",
                    "size": 3636455,
                    "width": 3000,
                    "height": 4000
                  }
                ]
              },
              {
                "title": "First name",
                "description": "",
                "type": "text",
                "key": "84g9u",
                "custom_key": null,
                "value": "Douglas"
              },
              {
                "title": "Last name",
                "description": "",
                "type": "text",
                "key": "b6vtr",
                "custom_key": null,
                "value": "Oliveira"
              },
              {
                "title": "Email",
                "description": "",
                "type": "email",
                "key": "aohp1",
                "custom_key": null,
                "value": "douglasdesanti@gmail.com"
              }
            ],
            "form_id": "683d47c46625d325d100ad12",
            "slug": "myfurryprints",
            "submission_id": "685ff5cde783343e7504672a",
            "created_at": "2025-06-28 14:01:49",
            "ip_address": "89.243.136.35",
            "charge": {
              "products": [],
              "summary": "",
              "discount": 0,
              "discounted_subscriptions": [],
              "coupon": false,
              "total": 0,
              "total_cents": 0,
              "tax": 0,
              "tax_percentage": 0,
              "processing_fee": 0,
              "authorize": null,
              "receipt_email": false
            },
            "team_id": 474237,
            "base_slug": "ac7a8cum",
            "trigger": "submission",
            "device": {
              "type": "mobile",
              "device": "WebKit",
              "platform": "AndroidOS",
              "browser": "Chrome",
              "embedded": true,
              "url": "https://myfurryprints.paperform.co/?embed=1&takeover=0&inline=1&popup=0&_d=myfurryprints.com&_in=0",
              "user_agent": "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Mobile Safari/537.36",
              "utm_source": null,
              "utm_medium": null,
              "utm_campaign": null,
              "utm_term": null,
              "utm_content": null,
              "ip_address": "89.243.136.35"
            }
          },
          "webhookUrl": "https://primary-production-2739c.up.railway.app/webhook/upload_images_dev",
          "executionMode": "production"
        }
      }
    ]
  },
  "versionId": "3efd4820-6ff8-40f0-938b-28b9535b73a8",
  "activeVersionId": "3efd4820-6ff8-40f0-938b-28b9535b73a8",
  "versionCounter": 3,
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2025-06-30T08:08:40.559Z",
      "createdAt": "2025-06-30T08:08:40.559Z",
      "role": "workflow:owner",
      "workflowId": "l3VzrmMbOUXq4QDH",
      "projectId": "lLSHos7ohHn7AjNm",
      "project": {
        "updatedAt": "2025-06-14T17:25:02.061Z",
        "createdAt": "2025-06-14T17:13:49.092Z",
        "id": "lLSHos7ohHn7AjNm",
        "name": "Muhasin Rashid <muhasin@gauger.in>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "updatedAt": "2025-06-14T17:13:49.092Z",
            "createdAt": "2025-06-14T17:13:49.092Z",
            "userId": "f88f8c62-813a-499e-aaee-b5f4da43c5a7",
            "projectId": "lLSHos7ohHn7AjNm",
            "user": {
              "updatedAt": "2025-12-18T05:00:03.582Z",
              "createdAt": "2025-06-14T17:13:45.907Z",
              "id": "f88f8c62-813a-499e-aaee-b5f4da43c5a7",
              "email": "muhasin@gauger.in",
              "firstName": "Muhasin",
              "lastName": "Rashid",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-06-14T17:25:40.417Z",
                "personalization_survey_n8n_version": "1.97.1",
                "automationGoalDevops": [
                  "other"
                ],
                "automationGoalDevopsOther": "Product",
                "companyType": "ecommerce",
                "role": "engineering"
              },
              "settings": {
                "userActivated": true,
                "easyAIWorkflowOnboarded": true,
                "firstSuccessfulWorkflowId": "JsDBWbsoYaKBkGmW",
                "userActivatedAt": 1758182279933,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1752395252283
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-12-18",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": {
    "updatedAt": "2025-11-27T07:27:47.774Z",
    "createdAt": "2025-11-27T07:27:47.774Z",
    "versionId": "3efd4820-6ff8-40f0-938b-28b9535b73a8",
    "workflowId": "l3VzrmMbOUXq4QDH",
    "nodes": [
      {
        "parameters": {
          "method": "POST",
          "url": "https://integral-squirrel-52866.upstash.io/lpush/myfurryprints_queue",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"submission_id\": \"{{ $json.body.submission_id }}\",\n  \"customer_data\": {{ JSON.stringify($json.body.data) }},\n  \"timestamp\": \"{{ new Date().toISOString() }}\"\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          360,
          280
        ],
        "id": "783e40a3-fbd0-4719-82d4-0c1888a6d492",
        "name": "AddToQueue",
        "credentials": {
          "httpHeaderAuth": {
            "id": "OU4p8zTKeY9k8OYC",
            "name": "Upstash_new"
          }
        }
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "29bc334f-d636-43cc-920f-15b5a5427773",
          "options": {
            "allowedOrigins": "*",
            "binaryPropertyName": "images"
          }
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          20,
          280
        ],
        "id": "bc8adf7a-9706-42a9-898a-daf74b2c290c",
        "name": "Webhook",
        "webhookId": "29bc334f-d636-43cc-920f-15b5a5427773"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://integral-squirrel-52866.upstash.io/get/processing_lock",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          780,
          280
        ],
        "id": "dc700400-73eb-4e85-afa5-86af30f529c5",
        "name": "CheckProcessingLock",
        "credentials": {
          "httpHeaderAuth": {
            "id": "OU4p8zTKeY9k8OYC",
            "name": "Upstash_new"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "c61f1c28-46d7-4c55-b2a2-cea646a58c02",
                "leftValue": "={{ $json.result }}",
                "rightValue": "null",
                "operator": {
                  "type": "string",
                  "operation": "empty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          980,
          280
        ],
        "id": "6fdf82f7-0e0a-4cad-b25f-ef26aeb42220",
        "name": "If Not Processing"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://integral-squirrel-52866.upstash.io/setex/processing_lock/3700/processing",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1220,
          280
        ],
        "id": "4fa76e53-1f84-42e3-ad8b-d204ec3f8ffe",
        "name": "SetProcessingLock",
        "credentials": {
          "httpHeaderAuth": {
            "id": "OU4p8zTKeY9k8OYC",
            "name": "Upstash_new"
          }
        }
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "1059HGYFIUzHErGh",
            "mode": "list",
            "cachedResultName": "02-PicassoAlternative - Backup"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": true
          },
          "options": {
            "waitForSubWorkflow": true
          }
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.2,
        "position": [
          1660,
          280
        ],
        "id": "232e200b-4e6a-451b-91e7-3a71bcdd1f3c",
        "name": "Execute Workflow1"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://integral-squirrel-52866.upstash.io/rpop/myfurryprints_queue",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1440,
          280
        ],
        "id": "3412a6d0-129b-441e-be05-bd4569681301",
        "name": "PopJobAndProcess",
        "credentials": {
          "httpHeaderAuth": {
            "id": "OU4p8zTKeY9k8OYC",
            "name": "Upstash_new"
          }
        }
      },
      {
        "parameters": {
          "inputSource": "passthrough"
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          500,
          480
        ],
        "id": "9df0ca6a-0e25-45a1-9ece-a7fe06a705ca",
        "name": "When Executed by Another Workflow"
      },
      {
        "parameters": {
          "content": "WORKFLOW 1\n\n\nThis workflow handles incoming data from users and adds them to a queue in redis for processing. It makes sure that only one job is processed at a time by checking a processing lock in Redis (via Upstash). When ready, it pops a job from the queue, locks the processing, and triggers another workflow to handle the actual job. It helps manage jobs smoothly without overloading the system.",
          "height": 200,
          "width": 640
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          0,
          0
        ],
        "id": "533479e6-f066-454c-b9d5-2a9811bb69e8",
        "name": "Sticky Note"
      }
    ],
    "connections": {
      "AddToQueue": {
        "main": [
          [
            {
              "node": "CheckProcessingLock",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook": {
        "main": [
          [
            {
              "node": "AddToQueue",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CheckProcessingLock": {
        "main": [
          [
            {
              "node": "If Not Processing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Not Processing": {
        "main": [
          [
            {
              "node": "SetProcessingLock",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SetProcessingLock": {
        "main": [
          [
            {
              "node": "PopJobAndProcess",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "PopJobAndProcess": {
        "main": [
          [
            {
              "node": "Execute Workflow1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "CheckProcessingLock",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "system migration",
    "name": null,
    "description": null,
    "workflowPublishHistory": [
      {
        "createdAt": "2025-06-30T08:12:32.499Z",
        "id": 8,
        "workflowId": "l3VzrmMbOUXq4QDH",
        "versionId": "3efd4820-6ff8-40f0-938b-28b9535b73a8",
        "event": "activated",
        "userId": null
      }
    ]
  }
}